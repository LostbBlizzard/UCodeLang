build-Windows:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up MinGW
        uses: egor-tensin/setup-mingw@v2
        with:
          platform: x64

      - name: Set up MinGW_32
        uses: egor-tensin/setup-mingw@v2
        with:
          platform: x86

      - name: Run Premake
        run: ./GNU_Make.sh

      - name: Restore cached objs
        id: cache-objs-restore
        uses: actions/cache/restore@v3
        with:
          path: ./Output
          key: ${{ runner.os }}-windows-deployment

      - name: Build 64 bit
        run: |
           cd ./BuildTools
           ./BuildWin64Published.sh

      - name: Build 32 bit
        run: |
           cd ./BuildTools
           ./BuildWin32Published.sh

      - name: Save cached Objs
        id: cache-Objs-save
        uses: actions/cache/save@v3
        with:
          path: ./Output
          key: ${{ steps.cache-objs-restore.outputs.cache-primary-key }}

      - name: Archive Output
        uses: actions/upload-artifact@v3
        with:
          name: Output_Windows
          path: Output/
          retention-days: 1


gmake-windows-build:
   runs-on: ubuntu-latest

   steps:
    - uses: actions/checkout@v3
    
    - name: Set up MinGW
      uses: egor-tensin/setup-mingw@v2
      with:
        platform: x64

    - name: Set up MinGW_32
      uses: egor-tensin/setup-mingw@v2
      with:
        platform: x86

    - name: Make a scripts executable
      run: |
       chmod +x ./GNU_Make.sh
       chmod +x ./BuildTools/BuildLinux32Debug.sh
       chmod +x ./BuildTools/BuildLinux64Debug.sh
       chmod +x ./BuildTools/RunTestsLinux32Debug.sh
       chmod +x ./BuildTools/RunTestsLinux64Debug.sh

    - name: Restore cached objs
      id: cache-objs-restore
      uses: actions/cache/restore@v3
      with:
        path: ./Output
        key: ${{ runner.os }}-cl-windows

    - name: Build 64 bit
      run: ./BuildTools/BuildWin64Debug.sh

    - name: Build 32 bit
      run: ./BuildTools/BuildWin32Debug.sh

    - name: Save cached Objs
      id: cache-Objs-save
      uses: actions/cache/save@v3
      with:
        path: ./Output
        key: ${{ steps.cache-objs-restore.outputs.cache-primary-key }}

    - name: RunTests for 64 bit
      run: ./BuildTools/RunTestsLinux32Debug.sh

    - name: RunTests for 32 bit
      run: ./BuildTools/RunTestsLinux64Debug.sh
